<?xml version = "1.0" encoding = "utf-8" ?> 

<!--********** Copyright 2016 Roku Corp.  All Rights Reserved. **********-->

<component name = "KeyboardDialogExample" extends = "Group" >
<interface>
<field id="globalusername" type="string" onChange = "GetAuthData"/>
<field id="globalpass" type="string" onChange = "GetAuthData"/>
<field id="valueforuri" type="string" />
</interface>
  <script type = "text/brightscript" >

    <![CDATA[

    sub init()
    
      m.top.backgroundURI = "pkg:/images/bkg_hd.png"
	  
      m.keyid = m.top.findNode("instructid")
	  m.keypass = m.top.findNode("instructpass")
	  m.btnsubmit = m.top.findNode("btnsubmit")
	  m.btnsetting = m.top.findNode("btnsetting")
	  m.btngrp = m.top.findNode("btngrp")
	  
	  
      'keyidrect = m.keyid.boundingRect()
      'centerx = (1280 - keyidrect.width) / 2
      'centery = (720 - keyidrect.height) / 2
      'm.keyid.translation = [ centerx, centery ]
	 ' m.btngrp.buttons = ["Sing In","Setting"]                'here write the Login Button
	  m.btngrp.observeField("buttonSelected","signinclick")   'here the call observefield for a Button Group its SignIn and Setting
	  ? "button group value print : " m.btngrp.buttons
	  m.top.setFocus(true)
      
    end sub
    
    function showdialogid()
    
      keyboarddialogid = createObject("roSGNode", "KeyboardDialog")
      
     
      keyboarddialogid.backgroundUri = "pkg:/images/bkg_hd.png"
      keyboarddialogid.title = "Keyboard for a Email"
      
      if m.keyid.id = "instructid" then
      		
      		keyboarddialogid.text = m.keyid.text
      
      end if
      
      keyboarddialogid.buttons=["Ok","Cancel"]
      m.top.dialog = keyboarddialogid
      m.top.dialog.observeField("buttonSelected","onVerifyid")
      return true
      
    end function
    
    sub showdialogpass()
    
  		keyboarddialogpass = createObject("roSGNode", "KeyboardDialog")
  		keyboarddialogpass.backgroundUri = "pkg:/images/bkg_hd.png"
  		keyboarddialogpass.title = "Keyboard for a Password"
  		keyboarddialogpass.buttons=["Ok","Cancel"]
  		if m.keypass.id = "instructpass" then	
  		
      		keyboarddialogpass.text = m.keypass.text
      		
      	end if
  		m.top.dialog = keyboarddialogpass
  		m.top.dialog.observeField("buttonSelected","onVerifypass")
  	
	end sub

	sub onVerifyid() ' for username dialog box
	
    	if m.top.dialog.buttonSelected = 0
    	
    				if m.keyid.id = "instructid" then
    					
       					print "ok button pressed" 'O is called first
       					
       					m.keyid.text = m.top.dialog.text
       					
       					? "TextBox Id is display : "m.keyid.text
       					
       					m.top.dialog.close = true
       					
       				end if
       				
    	else if m.top.dialog.buttonSelected = 1  
    	
       		print "cancel button pressed" '1 is called first
       		m.top.dialog.close = true
       		
    	else
    	
        	print "nothing press" ' this is not require for code just write understanding
        
    	end if
    
	end sub
	
	sub onVerifypass() ' for password dialog box
	
    	if m.top.dialog.buttonSelected = 0
       				
       				if m.keypass.id = "instructpass" then
    					
       					print "ok button pressed" 'O is called first
       					
       					m.keypass.text = m.top.dialog.text
       					
       					? "TextBox Pass is display : " m.keypass.text
       					m.top.dialog.close = true       					
       				end if
       				
    	else if m.top.dialog.buttonSelected = 1  
    	
       		print "cancel button pressed" '1 is called first
       		m.top.dialog.close = true
       		
    	else
    		
        	print "nothing press" ' this is not require for code just write understanding
        
    	end if
    
	end sub
	
	Function GetAuthData() As Dynamic  ' function for read data from roRegistrySection
		' reg = CreateObject("roRegistry")
	
 		sec = CreateObject("roRegistrySection", "Authentication")
 	
		' print "section : " + Authentication
 		if sec.Exists("Authentication")
 	
  		print "Read username : " + m.top.globalusername + "Read password : " + m.top.globalpass
  		print " ****************** DATA username : " + m.top.globalusername + "password : " + m.top.globalpass
  	
  		return sec.Read("Authentication")
 		'return sec.Delete("Authentication") ' Here not override concept so compalsary delete first and after again second URL Store pannel.brs and hud.brs both file

 		print "***********************GetAuthData************************"
 	
 		endif

 		return invalid
 		
	End Function

	'Here the SetAuthData to wrire username and password
	
	Function SetAuthData(zxorausername As String, zxorapassword As String) As Void 'function for write data from roRegistrySection
	
		' reg = CreateObject("roRegistry")
	
 		sec = CreateObject("roRegistrySection", "Authentication")
 	
	 	m.top.globalusername = zxorausername
	 	
	 	m.top.globalpass = zxorapassword
	 
		' if not m.top.globalusername = zxorausername and m.top.globalpass = zxorapassword 
	
		sec.Write("Authentication", m.top.globalusername)
		sec.write("Authentication", m.top.globalpass)
	
		?"key for the username and password" sec.GetKeyList()

    	Print " Write username :" + m.top.globalusername + " Write pass :" + m.top.globalpass
    	
		' end if

 		print "***********************SetAuthData************************"
		' Flush(true)
    
	End Function
	
sub dbText() 'here the store value from the textbox text and call two function(getauthdata,setauthdata) here
	
    print "***************   I am in dbText() *************"
    
    'cText print the Copied text its last charecter display its use right function
    
    serverusername = m.keyid.text
    serverpass = m.keypass.text
    
    
    Print "Username ServerUsename: " + serverusername + "Password ServerPassword :" + serverpass
   
    'Print The Error message viewer Enter the Wrong URL
    
    'Here call first time otherwise not compare to right username and wrong pass
    
                m.top.globalusername = GetAuthData()
                m.top.globalpass = GetAuthData()
                print " Read username : " + m.top.globalusername + " Read pass : " + m.top.globalpass
                SetAuthData(Serverusername,Serverpass)
                
End sub

function signinclick() as boolean
		? "call signinclick function"
	     
	  if m.btngrp.buttonSelected = 0 then  'here issue is on click event not proper work on sign in button
      
      			? " calling function : btnsubmit  "

      					dbText()  'function inside only call function  and any action with parameter always use function because sub is not handle the keyevent
      					
      				'	init()		
      		handled = true		
      else if m.btngrp.buttonSelected = 1 then  'function is write on outside in keyevent Because in keyevent not handled button event
      
            			? " calling function : btnsetting "

      					dbText() 
      					
      				'	init()
      			handled = true
      end if
      return handled
      
end function

function clickLogin()

' here is use the button focus after the ok
        		if m.btngrp.buttonSelected = 0 then 
        			if key = "OK"
          				? "print the signIn button"
          			end if
          		else if m.btngrp.buttonSelected = 1 then
          			if key = "OK"
          				? "print the setting button"
          			end if
          			
          		else 
          			   ? "nothig press"
          		end if

end function

function onKeyEvent(key as String, press as Boolean) as Boolean


?"key value : " key
?"press value : " press

'here the press value given the false at the setting button up key value

'Apply the logic for the here the press true and logic is apply 

'It's here the right is handle is false but not working. I found the another way to the manage the key
handled = false	  



 ? "here the focus available "
	 if press = true then
     	
      if m.keyid.active = true and key = "OK" then
      	?"Email Ok Press"
      	        
          		showdialogid()   
          		handled = true
          		
      else if m.keypass.active = true and key = "OK" then
        ?"Password Ok Press"
        
          		showdialogpass()
          		handled = true 
          		
      end if
      return handled 
     
    end if
    
    if press = false then

	  ' here the every time call if condition if enter the value on keyboard and keybord ok press to call textbox password active = true
    if m.keyid.active = true then 
     		m.keyid.active = false
     	end if
            if key = "up" or key = "down"
				
				if key = "down"
					?"here down key"
					
					if m.keypass.active = true 
					    
					    m.keyid.active = false
						m.keypass.active = false
						m.btnsubmit.setFocus(true)
					    m.btnsubmit.focusBitmapUri = "pkg:/images/newsignin.png"
					    m.btnsubmit.iconUri=""
					    m.btnsubmit.focusedTextColor = "0x00000000"
						handled = true
						
					else if m.keyid.active = true
					    
						m.keyid.active = false
						m.keypass.active = true
						handled = true
							
					else if m.btnsubmit.focusBitmapUri <> "" 
					
						? "setting active and key down press " 
						m.btnsubmit.focusBitmapUri = "" 
						m.btnsubmit.setFocus(false)
						m.btnsetting.setFocus(true)
						m.btnsetting.focusBitmapUri = "pkg:/images/newsetting.png"
						m.btnsetting.focusedTextColor = "0x00000000"
						handled = true
						
					else if m.btnsetting.focusBitmapUri <> ""
					 
					   ? "id active and key down press"
					   m.btnsetting.focusBitmapUri = ""
					   m.btnsetting.setFocus(false)
					   m.keyid.setFocus(true)
					   m.keyid.active = true
					   handled  = true
						
						handled = true   
					end if
					handled = true
					
				else if key = "up"

					? "here up key"
					if m.keypass.active = true 
					
						?"id active and press up"
						m.keypass.active = false
						m.keyid.active = true
						handled = true
						
					else if m.keyid.active = true 
					
						?"setting active and press up"
						
						m.keyid.active = false
						m.btnsetting.setFocus(true)
						m.btnsetting.focusBitmapUri = "pkg:/images/newsetting.png"
						m.btnsetting.focusedTextColor = "0x00000000"
						handled = true

			        else if m.btnsetting.focusBitmapUri <> "" 
					     ?"submit active and press up"
					     
					     m.btnsetting.focusBitmapUri = ""
					     m.btnsetting.setFocus(false)
						 m.btnsubmit.setFocus(true)
						 m.btnsubmit.focusBitmapUri = "pkg:/images/newsignin.png"
						 m.btnsubmit.iconUri=""
						 m.btnsubmit.focusedTextColor = "0x00000000"
						 handled = true
					
					else if m.btnsubmit.focusBitmapUri <> "" 
					    
						? "pass active and press up"						 
						'press = false
						? "press value active : " press 
						m.btnsubmit.focusBitmapUri = ""
						m.btnsubmit.setFocus(false)
						m.keypass.setFocus(true)
						m.keypass.active = true
				        handled = true
					end if
					handled = true
				end if
				handled = true
			end if
			
'	   if key = "OK" and m.btnLogout.focusBitmapUri <> "" 
'      
'         ?"Click the Logout button"
'         
'         m.btnLogout.visible = false
'         m.btnLogout.focusBitmapUri = ""
'         m.loginscreengrp.visible = true
'         m.keyid.active = true
'         m.keypass.active = false
'         handled = true
        
       if key = "OK" and m.btnsetting.focusBitmapUri <> ""
       
      	?"Click the sign in button"
      	
      	 'signinclick()
'      	 m.btnsetting.focusBitmapUri = ""
'      	 m.instructSave.active = true
      	 'm.btnLogout.visible = true
     	 'm.btnLogout.setFocus(true)
     	 'm.btnLogout.focusBitmapUri = "pkg:/images/Logout.png"
      	 'm.btnLogout.focusedTextColor = "0x00000000"
         handled = true
         
       else if key = "OK" and m.btnsubmit.focusBitmapUri <> ""
        
      
'        m.btnsubmit.focusBitmapUri = ""
'        m.loginscreengrp.visible = false
'        m.Homescreen.visible = true
'        m.btnLogout.setFocus(true)
'        m.btnLogout.setFocus(true)
'     	m.btnLogout.focusBitmapUri = "pkg:/images/Logout.png"
'      	m.btnLogout.focusedTextColor = "0x00000000"
        handled = true
        
      end if 
      
   return handled
   end if
   return true
end function

    ]]>

  </script>
  <children >
      <Label  
      id = "RokuLogin" 
      font="font:LargeBoldSystemFont"
      text = "Sign In using your ZXORA Account"
      translation = "[550,200]" /> 
      
      <TextEditBox 
      id = "instructid" 
      width = "700"
      hintText = "Email" 
      active = "true"   
      translation = "[600,280]"
       />
      
      <TextEditBox 
      id = "instructpass" 
      width = "700"
      hintText = "Password"
      secureMode = "true"
      translation = "[600,360]"
       />       
       
       <!-- focusBitmapUri use for ButtonSelected and focusFootprintBitmapUri use for ButtonDisplayed -->
       <ButtonGroup id = "btngrp"
       translation = "[250,470]" visible="false" />
 
        <Button 
      id = "btnsubmit" 
      iconUri=""
      focusedIconUri=""
      showFocusFootprint = "true" 
      focusFootprintBitmapUri = "pkg:/images/signin.png"
      minWidth = "150" 
      height = "50"
      translation = "[775,500]" />
	
	  <Button 
      id = "btnsetting" 
      iconUri=""
      focusedIconUri=""
      showFocusFootprint = "true" 
      focusFootprintBitmapUri = "pkg:/images/setting.png"
      minWidth = "150" 
      height = "50"      focusedTextColor = "#FFFFFFFF"
      translation = "[975,500]" />
      
  </children>

</component>
